# ADRs + LLM/GenAI Tools + MCP Agents: Focused Research for Payments Architecture

## Executive Summary

The convergence of **Architectural Decision Records (ADRs)**, **Large Language Models (LLMs)**, and the **Model Context Protocol (MCP)** is creating powerful new capabilities for automating architecture governance in payments systems. Research from 2024-2025 demonstrates that LLMs can effectively generate ADRs from code changes, validate architectural decisions, and serve as intelligent agents that enforce standards. MCP provides the standardized protocol layer enabling AI agents to access data models, lineage information, and architectural artifacts - making "living documentation" and real-time impact analysis feasible at enterprise scale.

---

## 1. LLM-Powered ADR Generation & Automation

### Academic Research: ADRs Can Be Generated by LLMs

**Study**: "Can LLMs Generate Architectural Design Decisions?" (March 2024, arXiv)
- **Key Finding**: GPT-3.5, GPT-4, and T5-based models can generate relevant Design Decisions adhering to ADR markdown format
- **Approaches Tested**:
  - 0-shot prompting: Including term "Architectural Decision Record" in prompt enhances performance
  - Few-shot prompting: Cost-effective models like GPT-3.5 achieve similar outcomes to GPT-4
  - Fine-tuning: Smaller models like Flan-T5-base yield comparable results after fine-tuning
- **Implication**: Privacy-sensitive organizations can use fine-tuned smaller models on-premise for ADR generation

### Production Implementations

#### cADR - Automated ADR from Git Changes (GitHub: YotpoLtd/cADR)
**Features**:
- LLM-Powered Analysis using OpenAI and Gemini to detect architecturally significant changes
- Automated ADR Generation following MADR template format
- Git Integration analyzing staged changes, uncommitted changes, or commit ranges
- Generated ADRs include: Context & Problem Statement, Decision Details, Alternatives Considered, Consequences

**Configuration**: Simple YAML-based setup
```yaml
provider: openai
analysis_model: gpt-4
api_key_env: OPENAI_API_KEY
timeout_seconds: 15
ignore_patterns:
  - node_modules/**
  - "*.test.ts"
```

#### GitHub PR-Based ADR Automation (Iraj Hedayati, Sept 2025)
**Workflow**:
1. Developer opens PR with major change
2. Script collects: PR number, commit message, author, git diff
3. LLM (OpenAI GPT) receives prompt: "Generate an ADR based on this PR diff"
4. Model drafts ADR in Markdown, saves to /docs/adr/

**Benefits**:
- Always up-to-date: ADRs generated simultaneously with code changes
- In-repo traceability: ADRs versioned with Git
- Low friction: Developers don't stop coding to write docs
- Living documentation: New hires understand "why", architects review with context

#### Enterprise Implementation: Nationale Nederlanden (NN Group)
**Multi-Agent Architecture** (Piethein Strengholt, Sept 2025):
- **Writer Agent**: Generates ADR from context using enterprise architecture documents (RAG-based)
- **Validator Agent**: Checks for mandatory fields, prompts user if missing
- **Formatter Agent**: Ensures consistent markdown formatting

**System Prompt Example**:
```
You are an experienced enterprise architect. You assist in writing Architecture 
Decision Records (ADRs). Given the following context, generate an Architecture 
Decision Record (ADR) in Markdown format. Use the context from the Architecture 
document. Include the problem, decision, status, alternatives considered, 
pros/cons, and consequences.
```

**Key Lesson**: "Prompts can often replace complex business logic. Instead of hardcoding rules, you let agents handle nuance through carefully designed instructions."

---

## 2. AI Agents for Architectural Governance & Standards Enforcement

### Agent-Powered Enforcement in Development Workflows

**Article**: "Using AI Agents to Enforce Architectural Standards" (Dave Patten, April 2025)

**Integration Points**:
- **GitHub Actions + LangChain**: AI agents evaluate PRs against architecture rules during CI
- **Slack + Claude**: Teams query design decisions, policies, or architecture interactively
- **Obsidian + LLM plugins**: Validate ADRs, refactor design notes, maintain consistency
- **Notion + agent orchestration**: Track architecture changes, tag outdated records, highlight decision inconsistencies

**Enforcement Capabilities**:
- **IaC Review**: Detect security misconfigurations, non-standard provisioning
- **Source Code**: Flag business logic in UI layer, tightly coupled modules
- **Architecture Diagrams**: Identify missing failover paths, violations of layered architecture
- **ADRs**: Validate completeness, consistency across decisions

**Example Prompts**:
```
Review this Terraform file for violations of our approved VPC and subnet structure. 
Ensure all instances use managed identity and no public IPs are assigned.

Given this PlantUML diagram, check whether the web tier connects directly to the 
database. Flag any violation of the 3-tier model.
```

### Equal Experts Approach: Metaprompting for Retroactive ADRs

**Challenge**: Document dozens of critical architectural choices that were never formally recorded

**Solution**: LLM-driven workflow using Google Gemini and OpenAI ChatGPT
1. **Extract "kernel of truth" one-liners** from code, docs, stakeholder conversations
2. **Reconstruct decision context** using git history, library introduction dates
3. **Metaprompting approach**: Design template prompt that creates bespoke prompts for each decision
4. **LLM Judge**: Use separate LLM prompt to critique generated ADRs for logical flaws before human review

**Template Structure**:
```markdown
#ADR-XYZ-<0029> <The title here>

## Background
Describe the context for the decision. Why did it need to be made? 
What was the state before the decision?

## Alternatives
Think HARD to consider good, applicable alternatives. 
Search the web for the latest options.

## Decision
Call out the actual decision here

[Additional sections...]
```

**Key Principles**:
- Transparent about AI usage (avoid "AI slop")
- Focus on value of accurate architecture picture
- Documentation becomes natural artifact of development workflow

### Salesforce: Human-Led, AI-Powered ADR Approach

**Core Principle**: "Human-in-the-Loop" (HITL) paradigm
- LLMs operate on pattern recognition, not comprehension
- Lack professional judgment, business context, empathy
- Require human intervention to prevent disasters

**Best Practices**:
1. **Formal disclosure**: Document AI's role in ADR drafting
2. **Privacy protection**: Ensure public LLMs don't use inputs for training
3. **Review ToS**: Activate options preventing conversation use for training
4. **Consistent format**: Use ADR structure even if not formal ADR process

**Risk Management**:
- Preventing proprietary information exposure
- Mitigating societal biases amplified through training data
- Ensuring explainability despite probabilistic nature

---

## 3. Model Context Protocol (MCP) for Architecture Context Management

### MCP Architecture Fundamentals

**What MCP Solves**: The "AI Integration Paradox" - giving AI systems rich, secure access to external resources without creating security nightmares

**Core Architecture** (Three Components):
1. **Host Application**: Security broker (Claude Desktop, IDE) that mediates ALL AI-resource interactions
2. **MCP Client**: Interface between host and server, embedded in host
3. **MCP Server**: Where tools/data live - connects to databases, APIs, files

**Design Principles**:
- **1:1 Client-Server Mapping**: Each resource type gets dedicated, isolated communication
- **Capability-Based Security**: Servers declare capabilities, Hosts decide what to allow
- **Dynamic Discovery**: AI finds what it needs without hard-coded integrations
- **Bidirectional Flow**: AI can ask questions, not just receive responses

### MCP for Multi-Agent Architectural Systems

**Research**: "Advancing Multi-Agent Systems Through Model Context Protocol" (April 2025, arXiv)

**Agent Types Enabled by MCP**:
1. **Specialist Agents**: Domain-specific expertise (security review, performance analysis)
2. **Coordinator Agents**: Task allocation and progress tracking
3. **Legacy System Agents**: Protocol translation between legacy APIs and MCP
4. **Human-in-the-loop Agents**: Incorporate human judgment within workflow

**Architectural Advantages**:
- Clear separation of concerns (clients = reasoning, servers = data/tools)
- Flexible deployment (same machine, network, remote)
- Independent evolution while maintaining protocol compatibility
- Scalable patterns (one-to-many, many-to-one)

**Context Management Benefits**:
- Standardized mechanisms for context storage, retrieval, sharing
- Addresses "disconnected models problem" in agent operation
- Enables extended reasoning chains across agent boundaries
- Richer contextual awareness for decision-making

### MCP-Enabled Agent Frameworks

#### Agent-MCP Framework (GitHub: rinadelph/Agent-MCP)
**Purpose**: Multi-agent systems for parallel development with shared context

**Key Capabilities**:
- **Shared Knowledge Graph**: Architectural decisions, design patterns stored centrally
- **Task Memory**: Current status, blockers, implementation notes
- **Agent Memory**: Individual agent learnings and specializations
- **File-level Locking**: Prevents merge conflicts from simultaneous edits

**Benefits**:
- Parallel Development: Backend and frontend agents work simultaneously
- No Lost Context: Every decision instantly understood by new agents
- Predictable Outputs: Focused agents with limited context produce consistent results
- Complete Transparency: Dashboard shows AI team working in real-time

#### mcp-agent Framework (lastmile-ai/mcp-agent)
**Vision**: "MCP is all you need to build agents" - simple patterns > complex architectures

**Features**:
- Full MCP support with automatic server lifecycle management
- Implements Anthropic's "Building Effective Agents" patterns
- Temporal-backed durability for pause/resume/recover
- Pythonic API with decorators and context managers

**Production-Ready**:
- Structured logging
- Token accounting
- Cloud deployment support
- Works with any MCP server (filesystem, Slack, Jira, FastMCP apps)

---

## 4. Real-Time Impact Analysis via MCP + Observability

### Industrial Applications (Medium article, April 2025)

**Manufacturing Robot Example**:
- MCP-enabled AI robot (ESP32 + Claude AI)
- MCP bridges high-level AI logic with low-level motor controls
- Real-time commands, sensor data, dynamic behavior adjustment
- Natural language instructions integrated with IoT-level commands

**Adaptive Decision-Making**:
- Weather MCP server reports hurricane warning on planned route
- Agent detects new context, re-evaluates plan immediately
- Queries for alternate routes/transportation modes
- Closed-loop adaptation through lightweight MCP operations

**Supply Chain Example**:
- Disruption occurs (supplier delay)
- MCP-enabled agent retrieves historical delay records via MCP
- Analyzes routing data
- Recommends better route or alternative suppliers

### Integration with Data Lineage for Impact Analysis

**Pattern**: MCP Servers expose lineage information as resources/tools
- OpenLineage-compatible lineage backends (Marquez, DataHub)
- Column-level lineage tracking
- Schema change propagation across pipeline boundaries
- "Blast radius" assessment for proposed changes

**Architecture Decision Impact Workflow**:
1. ADR proposes data model change
2. AI agent queries MCP server for lineage graph
3. Agent identifies affected downstream systems, services, transactions
4. Agent generates impact report with affected customers
5. Human reviews and approves before deployment

---

## 5. Practical Implementation Patterns for Payments/Banking

### Pattern 1: Git-Integrated ADR Pipeline with LLM Validation

**Components**:
- GitHub Actions trigger on PR creation
- LLM (GPT-4/Claude) analyzes diff for architectural significance
- cADR or custom script generates MADR-formatted ADR
- Validator agent checks mandatory fields (PCI-DSS compliance, security review, data encryption)
- ADR stored in /docs/adr/ with PR reference

**Banking-Specific Extensions**:
- Compliance validation (PCI-DSS, GDPR, SOX)
- Security architecture review checklist
- Data residency and encryption requirements
- Regulatory impact assessment

### Pattern 2: MCP-Based Architecture Governance Agent

**Architecture**:
```
┌─────────────────────────────────────────────┐
│         Host (Claude Desktop/IDE)           │
│  ┌──────────────────────────────────────┐   │
│  │     Governance Coordination Agent    │   │
│  └──────────────────────────────────────┘   │
│           │          │          │            │
└───────────┼──────────┼──────────┼────────────┘
            │          │          │
    ┌───────┘          │          └────────┐
    ▼                  ▼                   ▼
┌─────────┐      ┌──────────┐      ┌──────────┐
│ADR MCP  │      │Lineage   │      │Catalog   │
│Server   │      │MCP Server│      │MCP Server│
│         │      │(OpenLine)│      │(Atlan/   │
│/docs/adr│      │          │      │ Collibra)│
└─────────┘      └──────────┘      └──────────┘
```

**Agent Capabilities**:
- Query existing ADRs via MCP
- Analyze data lineage for change impact
- Validate against catalog metadata
- Generate impact reports
- Suggest alternatives based on past decisions

### Pattern 3: Multi-Agent ADR Workflow for Complex Decisions

**Agents**:
1. **Research Agent**: Gathers context from code, docs, Slack, Jira (via MCP servers)
2. **Draft Agent**: Generates initial ADR using collected context
3. **Standards Agent**: Validates against architectural principles, security policies
4. **Impact Agent**: Analyzes downstream effects using lineage MCP server
5. **Review Agent**: Formats for human review, highlights areas needing attention

**Shared Context via MCP**:
- All agents access same architectural repository
- Decisions recorded in shared knowledge graph
- Context persists across agent interactions
- Human reviews at key checkpoints

### Pattern 4: Backstage + MCP Integration for Developer Portal

**Architecture**:
- Backstage service catalog integrates ADR plugin
- MCP server exposes ADR repository
- Developers query ADRs through natural language (Claude integration)
- ADRs linked to services they govern
- Cross-organizational ADR discovery

**Developer Workflow**:
1. Developer views service in Backstage
2. Sees linked ADRs explaining design decisions
3. Can ask questions: "Why did we choose PostgreSQL for this service?"
4. Claude queries ADR MCP server, returns context-aware answer
5. New decisions trigger automated ADR generation via pipeline

---

## 6. Tools & Frameworks Summary

### ADR Generation Tools
| Tool | Type | Key Feature |
|------|------|-------------|
| **cADR** | CLI Tool | Git-integrated, MADR format, OpenAI/Gemini |
| **Workik ADR Generator** | Web Platform | AI-powered, compliance integration (GDPR, HIPAA) |
| **Equal Experts Metaprompting** | Process | Retroactive ADR generation, LLM judge validation |
| **adr CLI (.NET)** | CLI Tool | Creating & managing ADRs programmatically |

### MCP Agent Frameworks
| Framework | Best For | Key Differentiator |
|-----------|----------|-------------------|
| **mcp-agent** | Production agents | Temporal durability, Anthropic patterns |
| **Agent-MCP** | Multi-agent systems | Shared knowledge graph, parallel development |
| **FastMCP** | Python MCP servers | Rapid MCP server creation |
| **MCP SDK** | Node/TypeScript | Official Anthropic SDK |

### Architecture Enforcement
| Tool | Purpose | Integration |
|------|---------|-------------|
| **ArchGuard** | Fitness functions | Multi-level scanning, C4 visualization |
| **OPA** | Policy-as-code | K8s, Terraform, API gateways |
| **Sentinel** | Policy enforcement | HashiCorp ecosystem |
| **Backstage ADR Plugin** | Developer portal | Service catalog integration |

---

## 7. Key Opportunities for Payments Architecture

### Immediate Wins

1. **Automated ADR Generation from PR Review**
   - Low effort, high value
   - Reduces documentation burden
   - Creates audit trail automatically
   - Implementation: GitHub Action + cADR + custom validation

2. **LLM-Based Retroactive Documentation**
   - Document existing undocumented decisions
   - Equal Experts metaprompting approach
   - Critical for legacy payments systems
   - Implementation: 1-2 week sprint with GPT-4/Claude

3. **Design Review Automation**
   - AI agent validates ADRs against standards
   - Checks PCI-DSS, security requirements
   - Flags issues before human review
   - Implementation: Custom agent using Claude + rule validation

### Strategic Capabilities

1. **MCP-Based Architecture Context Platform**
   - Centralized MCP server exposing:
     - ADR repository
     - Data model lineage (OpenLineage)
     - Service catalog (Backstage)
     - Compliance policies
   - AI agents query via MCP for impact analysis
   - Real-time "blast radius" calculation for changes

2. **Multi-Agent Architecture Review Board**
   - Specialist agents for security, performance, compliance
   - Coordinator agent orchestrates review process
   - Human-in-loop agent for final approval
   - Shared context via MCP ensures consistency

3. **Living Architecture Documentation**
   - ADRs automatically updated when code changes
   - Lineage automatically reflects in documentation
   - Impact analysis always current
   - Governance embedded in development workflow

### Advanced Integration

**Vision**: "Agentic-First" Payments Architecture Governance
- Every code change analyzed by AI for architectural significance
- Decisions automatically documented with full context
- Impact analysis computed in real-time via MCP lineage servers
- Exceptions and gate-keeping handled by AI agents with human oversight
- Business impact analysis linked to technical decisions

**Implementation Path**:
1. **Month 1-2**: Deploy automated ADR generation (cADR + custom validation)
2. **Month 3-4**: Build MCP servers for ADRs, lineage, catalog
3. **Month 5-6**: Develop governance agents (security, compliance, impact analysis)
4. **Month 7-8**: Integrate with Backstage/developer portal
5. **Month 9-12**: Deploy multi-agent review board with HITL

---

## 8. Critical Success Factors

### Technical

1. **Start with Standards**: Use MADR format, ensure consistency
2. **Privacy-First**: Use on-premise LLMs or ensure ToS prohibit training on data
3. **MCP Server Design**: Keep servers focused (single responsibility)
4. **Human-in-the-Loop**: Always review before production deployment
5. **Validation Layers**: Multiple agents check different aspects

### Organizational

1. **Transparency**: Disclose AI usage to build trust
2. **Incremental Adoption**: Prove value with pilot before scaling
3. **Developer Buy-In**: Make process easier, not harder
4. **Governance Alignment**: Ensure automated checks match existing policies
5. **Training**: Help architects understand how to work with AI agents

### Regulatory/Compliance (Banking-Specific)

1. **Audit Trail**: Every AI decision logged and traceable
2. **Compliance Validation**: Automated checks for PCI-DSS, GDPR, SOX
3. **Data Residency**: Ensure MCP servers comply with data location requirements
4. **Access Control**: Fine-grained permissions on MCP resources
5. **Model Risk Management**: Document LLM usage per OCC guidelines

---

## 9. References & Further Reading

### Key Academic Papers
- "Can LLMs Generate Architectural Design Decisions?" (arXiv, March 2024)
- "Advancing Multi-Agent Systems Through Model Context Protocol" (arXiv, April 2025)
- "FlowMind: Automatic Workflow Generation with LLMs" (ACM, July 2025)
- "LLM4Workflow: An LLM-based Automated Workflow Model Generation Tool" (ASE, 2024)

### Implementation Guides
- Anthropic: "Introducing Model Context Protocol" (anthropic.com/news/model-context-protocol)
- Equal Experts: "Accelerating ADRs with Generative AI" (equalexperts.com, 2025)
- Salesforce: "Architectural Decisions: A Human-Led, AI-Powered Approach" (salesforce.com, 2025)
- MCP Architecture Documentation (modelcontextprotocol.info)

### Open Source Tools
- cADR: github.com/YotpoLtd/cADR
- Agent-MCP: github.com/rinadelph/Agent-MCP
- mcp-agent: github.com/lastmile-ai/mcp-agent
- ADR Tools: github.com/joelparkerhenderson/architecture-decision-record
- Backstage ADR Plugin: github.com/backstage/community-plugins (workspaces/adr)

### Industry Implementations
- Nationale Nederlanden (NN Group): Multi-agent ADR writer (Piethein Strengholt, Medium)
- Block & Apollo: MCP integration for agentic systems (Anthropic announcement)
- Zed, Replit, Codeium, Sourcegraph: MCP for enhanced AI coding platforms

---

## Conclusion

The combination of **ADRs + LLMs + MCP** creates a powerful architecture governance capability specifically valuable for complex, highly-regulated environments like payments systems at large banks. The technology is mature enough for production use (multiple real-world implementations), yet early enough that your organization can gain competitive advantage through adoption.

**Key Takeaway**: This isn't about replacing architects with AI - it's about augmenting architecture governance with agents that automate documentation, validate decisions, analyze impact, and enforce standards, enabling architects to focus on strategic decisions rather than administrative overhead.

**Recommended Next Step**: Run a 2-week pilot using cADR for automated ADR generation on 2-3 active projects to demonstrate value before broader rollout.
